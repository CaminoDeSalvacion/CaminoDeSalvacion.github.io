<!DOCTYPE html>
<html lang="es">
<head> 
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Iglesia Cristiana El Camino De Salvaci贸n</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<header>
  <div class="logo-container">
    <img src="logo.png" alt="Camino De Salvaci贸n Logo">
  </div>
  <div class="divider"></div>
  <div class="header-text">
    <!-- Add lights to these titles -->
    <h1 class="light-letters">Iglesia Cristiana </h1>
    <h1 class="light-letters">El Camino De Salvaci贸n</h1>
    <p>Bienvenidos a nuestra transmisi贸n en vivo</p>
  </div>

  <!--  CHRISTMAS DECOR (trees + gifts) -->
  <div id="christmas-decor">
    <!-- Tree outside, gift toward center -->
    <div class="christmas-left">
       <span class="gift"></span>
    </div>
    <!-- Gift toward center, tree outside -->
    <div class="christmas-right">
      <span class="gift"></span> 
    </div>
  </div>
</header>

<div class="navbar">
  <a href="/" class="active">Inicio</a>
  <a href="anuncios/">Anuncios</a>
  <a href="versiculos/">Vers铆culos</a>
</div>

<div class="page-container">
  <main>
    <div class="video-container" id="video-box">
      <p>Cargando transmisi贸n...</p>
    </div>
    <div id="previous-video-box"></div>
  </main>
</div>

<footer>
  <p>漏 2025 Iglesia Cristiana El Camino De Salvaci贸n</p>
</footer>

<!-- Include centralized live.js -->
<script src="live.js"></script>
<script>
  const videoBox = document.getElementById("video-box");
  const previousBox = document.getElementById("previous-video-box");

  let currentVideo = null;
  let previousVideo = null;

  function renderVideo(videoId, title, showBack = false) {
    const html = `
      <h2 style="margin:10px 0; font-size:1.5em;">${title}</h2>
      <iframe
        src="https://www.youtube.com/embed/${videoId}?autoplay=1"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen loading="lazy">
      </iframe>
      ${showBack ? '<button class="back-button" onclick="showCurrentVideo()">Volver al Video Actual</button>' : ''}
    `;
    videoBox.innerHTML = html;
  }

  function showCurrentVideo() {
    if (!currentVideo) return;
    renderVideo(currentVideo.videoId, currentVideo.title, false);
    showPreviousThumbnail();
  }

  function showPreviousThumbnail() {
    if (!previousVideo || !previousBox) return;
    previousBox.innerHTML = `
      <div class="previous-video">
        <h3>Video Anterior</h3>
        <img src="https://img.youtube.com/vi/${previousVideo.videoId}/hqdefault.jpg"
             alt="${previousVideo.title}"
             onclick="showPreviousVideo()">
        <p>${previousVideo.title}</p>
      </div>
    `;
  }

  function showPreviousVideo() {
    if (!previousVideo) return;
    renderVideo(previousVideo.videoId, previousVideo.title, true);
  }

  // Fetch Worker and render video
  fetch('https://youtube-live-proxy.iglesia-4e5.workers.dev')
    .then(res => res.json())
    .then(data => {
      if (data.videoId) {
        currentVideo = { videoId: data.videoId, title: data.title };
        previousVideo = data.previousVideo || null;
        renderVideo(currentVideo.videoId, currentVideo.title, false);
        showPreviousThumbnail();
      } else {
        videoBox.innerHTML = `<p>No hay transmisi贸n disponible en este momento.</p>`;
      }
    })
    .catch(err => {
      console.error(err);
      videoBox.innerHTML = `<p>Error cargando transmisi贸n.</p>`;
    });

  // Initialize the dynamic live glow for Inicio tab
  Live.init();
</script>

<!-- ----------------------------- -->
<!-- CHRISTMAS VIBES MODULE        -->
<!-- ----------------------------- -->

<canvas id="snow-canvas"></canvas>

<script>
/* ---------- Snowfall ---------- */
const canvas = document.getElementById('snow-canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const snowflakes = Array.from({ length: 120 }, () => ({
  x: Math.random() * canvas.width,
  y: Math.random() * canvas.height,
  r: Math.random() * 4 + 1,
  d: Math.random() * 1
}));

function drawSnow() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.beginPath();
  ctx.fillStyle = "white";

  snowflakes.forEach(f => {
    ctx.moveTo(f.x, f.y);
    ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
  });

  ctx.fill();
  moveSnow();
}

function moveSnow() {
  snowflakes.forEach(f => {
    f.y += Math.pow(f.d, 2) + 1;
    if (f.y > canvas.height) {
      f.y = -10;
      f.x = Math.random() * canvas.width;
    }
  });
}

setInterval(drawSnow, 30);

window.addEventListener("resize", () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

/* ---------- Christmas Lights on Letters ---------- */
document.addEventListener("DOMContentLoaded", () => {
  const elements = document.querySelectorAll(".light-letters");
  const colors = ["#ff5252", "#ffca28", "#66bb6a", "#42a5f5"]; // red, yellow, green, blue

  elements.forEach(el => {
    const text = el.textContent;
    el.textContent = "";

    [...text].forEach((ch, i) => {
      if (ch === " ") {
        el.appendChild(document.createTextNode(" "));
        return;
      }

      const span = document.createElement("span");
      span.textContent = ch;
      span.className = "light-letter";
      span.style.setProperty("--bulb-color", colors[i % colors.length]);
      span.style.setProperty("--index", i);
      el.appendChild(span);
    });
  });
});
</script>

<style>
/* ---------- Snow canvas ---------- */
#snow-canvas {
  position: fixed;
  top: 0;
  left: 0;
  pointer-events: none;
  z-index: 9999;
}

/* Allow decor to anchor to the header */
header {
  position: relative;
}
/* ---------- Christmas Decor (trees + gifts) ---------- */
#christmas-decor {
  position: absolute;
  left: 0;
  right: 0;
  bottom: -6px;
  pointer-events: none;
  z-index: 10001;
}

#christmas-decor .christmas-left,
#christmas-decor .christmas-right {
  position: absolute;
  font-size: 3.1rem;
  display: flex;
  flex-direction: row;
  align-items: flex-end;
  gap: 4px;
  animation: blink 2s infinite alternate;
}

/* Trees moved EVEN FURTHER outward */
#christmas-decor .christmas-left  { left: 1.5%;  bottom: -2px; }
#christmas-decor .christmas-right { right: 1.5%; bottom: -2px; }

/* Small gifts */
#christmas-decor .gift {
  font-size: 1.1rem;
  margin-bottom: 0;
}

/* Tree blinking */
@keyframes blink {
  0%   { opacity: 1;   color: #4caf50; }
  25%  { opacity: 0.5; color: #f44336; }
  50%  { opacity: 1;   color: #4caf50; }
  75%  { opacity: 0.5; color: #b71c1c; }
  100% { opacity: 1;   color: #4caf50; }
}

/* ---------- Lights on top of letters ---------- */
.light-letters {
  position: relative;
}

.light-letter {
  position: relative;
  display: inline-block;
  color: inherit;        /* keep original header color */
  font-weight: inherit;
  text-shadow: none;
}

/* wire TOUCHING top of letters */
.light-letter::before {
  content: "";
  position: absolute;
  top: 0em;              /* right at top of glyph */
  left: 5%;
  width: 90%;
  height: 2px;
  background: #222;
  border-radius: 999px;
}

/* bulbs touching letters */
.light-letter::after {
  content: "";
  position: absolute;
  top: -0.18em;          /* overlaps letters slightly */
  left: 50%;
  transform: translateX(-50%);
  width: 0.34em;
  height: 0.34em;
  border-radius: 50%;
  background: var(--bulb-color);
  box-shadow: 0 0 6px var(--bulb-color);
  animation: bulb-blink 1.4s infinite;
  animation-delay: calc(var(--index) * 0.08s);
}

@keyframes bulb-blink {
  0%, 100% { opacity: 1; filter: brightness(1); }
  50%     { opacity: 0.4; filter: brightness(1.6); }
}

/* ---------- Festive navbar colors for active tab ---------- */
@keyframes christmas-tab {
  0% { background: #1b5e20; }   /* green */
  50% { background: #b71c1c; }  /* red */
  100% { background: #1b5e20; }
}

.navbar a.active {
  animation: christmas-tab 2s infinite;
  color: #fff !important;
}

/* Back button (used in previous video view) */
.back-button {
  background: #1b5e20 !important;
  color: #fff;
}
</style>

</body>
</html>
